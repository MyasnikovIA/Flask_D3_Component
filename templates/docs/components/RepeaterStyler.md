# RepeaterStyler

## Компонент: RepeaterStyler

Компонент RepeaterStyler предназначен для определения стиля репитера в зависимости от содержимого датасета по которому построен репитер.
Частный случай: раскраска грида.
Рассмотрим компонент на примере раскраски грида, где раскрашивается вся строка, либо отдельные поля.
Синтаксис написания компонента:

```xml
<component cmptype="RepeaterStyler" repeatername="имя репитера">
	<![CDATA[
		описание в формате JSON:
		{
			"specs":     [
					{"cond": "условие", "class":"classname1", "selector":"селектор"},
					{"cond": "условие", "class":"classname2", "selector":"селектор"},
					{"cond": "условие", "class":"classname3", "selector":"селектор"}
				    ] ,
			"classes":  {
					"classname1": {
							"normal":{},
							"active":{},
							"hover":{},
							"activehover":{}
						          },
					"classname2": {
							"normal":{},
							"active":{},
							"hover":{},
							"activehover":{}
						          }
				    }
		}
	]]>
</component>


```
specs — это массив описаний, каждое из которых представлено строкой в формате JSON: 
```js
{"cond": "условие", "class":"classname", "selector":"селектор"}
```
* **cond** — (обязательно для заполнения) javascript выражение, где к имени поля датасета можно обращаться как в js переменной. Например датасет нам вернул поля id, n_code, s_caption. Тогда в cond мы можем написать ```"n_code <== 10 || n_code == 20"```.
* **class** — (обязательно для заполнения) пишем имя css-класса. Этот класс может быть описан в блоке classes см Рисунок 1: Определение нового css класса, либо это может быть имя заранее определённого класса в системе (такие как styler-red, styler-blue, styler-yellow и т.д.), тогда в блоке classes его описания быть не должно.

Рисунок 1. Определение нового css класса
!RepeaterStyler1.png!


* **selector** — может опускаться из описания. Может содержать любой css селектор, подразумевающий поиск dom объектов внутри репитера. Если указан, то стиль будет применяться к объектам по селектору. По умолчанию селектор не указывается, и стиль применяется ко всему репитеру.
  + **classes** — описание css классов, ключём к которым является имя класса.
normal — (обязательно для заполнения). Описание css стиля, где ключем является имя css свойсва, а значением — значение css свойства. Применяется к репитеру (или селектору).
  + **active** — может опускаться из описания. Если описано, то применяется к активной строке репитера.
  + **hover** — может опускаться из описания. Если описано,то применяется к строке, на которую наведена мышь.
  + **activehover** — может опускаться из описания. Если описано, по применяется к строке одновременно  находящейся в состояниях active и hover.

**Пример:** Определение селектора (для 3х колонок). Cтиль применяется только к колонкам sank_mek, sank_mee, sank_ekmp.

```xml
            <component cmptype="RepeaterStyler" repeatername="MTR_BILL_HEADER_repeater">
                <![CDATA[
                {
                 "specs":   [
                             {"cond":"(10 <= days_fr_rb_in_date) && (days_fr_rb_in_date <= 20) && ['2','3', '4','mtr_bill_to_pay_st'].indexOf(status_code)> -1", "class":"styler-yellow"},
                             {"cond":"(21 <= days_fr_rb_in_date) && (days_fr_rb_in_date <= 25) && ['2','3', '4','mtr_bill_to_pay_st'].indexOf(status_code)> -1", "class":"styler-pink"},
                             {"cond":"(days_fr_rb_in_date > 25) && ['2','3', '4','mtr_bill_to_pay_st'].indexOf(status_code)> -1", "class":"clred"}
                            ],
                 "classes": {"clred":{
                                        "normal":   {"background-color": "#f4d8d8"}, 
                                        "active":   {"background-color":"#ebb2b2"}, 
                                        "hover":    {"background-color":"#ebb2b2"}, 
                                        "activehover":{"background-color":"#ebb2b2"}
                                     }
                            }
                }
                ]]>
            </component>      
```

## Применение в методах показа:

В разделе «Методы показа», во вкладке «Расширение» есть кнопка «Редактировать» с надписью «Настройка оформления».
Кнопка открывает текстовый редактор для ввода json-строки. В отличие от компонента RepeaterStyler строка должна быть обернута:
```js
{
	"style": { json-строка из компонента RepeaterStyler}
}
```

Например:

```js
{

       "style": {
			"specs":     [
					{"cond": "условие", "class":"classname1", "selector":"селектор"},
					{"cond": "условие", "class":"classname2", "selector":"селектор"},
					{"cond": "условие", "class":"classname3", "selector":"селектор"}
				     ]
		}

}
```

## Работа с Датами

Поле с типом «дата» воспринимается как строка, поэтому условие ```"cond": "ddate_bgn == '01.01.2015'"``` где  ddate_bgn поле с датой в формате "dd.mm.yyyy" сработает правильно. Но если нам необходимо сравнение дат, или же вычисление количества дней прошедших с одной даты до другой даты, то нам необходимо указать обработчику, что данное поле является датой.

**Например:**

* **не правильно:**  ```"cond": "ddate_bgn <= '21.01.2015'"``` — сравнит даты как строки и результат будет неверен
* **правильно:** ```"cond": "ddate_bgn::d <= '21.01.2015'::d"``` — сравнит даты как числа
_где  ddate_bgn='01.03.2015'_

Для обозначения даты доступен перечень ключей (d, h, m, s, ms) указанных через два двоеточия (::), которые одновременно указывают обработчику на тип данных «дата» и точность округления.

При указании одного из указанных ключей, дата переводится в число дней прошедших с 1 января 1970 года GMT+0.

* *::d* — возвращает ровное количество дней
* *::h* — количество дней с точностью до часа
* *::m* — количество дней с точностью до минуты
* *::ms* — количество дней с точностью до миллисекунды

например в переменной  ddate_bgn хранится дата со временем '01.01.2015 10:15', но нам надо сравнить её с датой без времени. Указав ключ ::d время (10:15) в расчет не возмется. Условие  ```ddate_bgn::d == '01.01.2015'::d``` выдает true.

Для понимания, обработчик при разборе условия строку ddate_bgn::m заменяет на вызов функции D3Api.dateToNum( ddate_bgn, 'm').

Не имеет смысла указывать более точный ключ, если исходные строка таких данных не содержит. Например: если ddate_bgn='01.01.2015 10:15', то для данной даты имеют смысл указывать ключи d или h или m. А остальные ключи s и ms не повлияют на результат, так как в дате нет секунд и миллисекунд.

**systemdate** - системная дата выраженная также в количестве дней. К systemdate также применяются ключи d, h, m, s, ms. Можно указывать без ключа, тогда подставится ключ по умолчанию: d.

например:

```
systemdate::d - ddate_bgn::d >= 10
```
и

```
systemdate - ddate_bgn::d >= 10
```
идентичны